#### –ó–∞–≤–¥–∞–Ω–Ω—è 1. –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é LRU-–∫–µ—à—É

–†–µ–∞–ª—ñ–∑—É–π—Ç–µ –ø—Ä–æ–≥—Ä–∞–º—É, —â–æ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î, —è–∫ LRU-–∫–µ—à –ø—Ä–∏—à–≤–∏–¥—à—É—î –±–∞–≥–∞—Ç–æ—Ä–∞–∑–æ–≤—ñ ¬´–≥–∞—Ä—è—á—ñ¬ª –∑–∞–ø–∏—Ç–∏ –¥–æ –≤–µ–ª–∏–∫–æ–≥–æ –º–∞—Å–∏–≤—É —á–∏—Å–µ–ª.

##### –¢–µ—Ö–Ω—ñ—á–Ω—ñ —É–º–æ–≤–∏

1. –ú–∞—î–º–æ –º–∞—Å–∏–≤ array –¥–æ–≤–∂–∏–Ω–æ—é N –∑—ñ —Å—Ç—Ä–æ–≥–æ –¥–æ–¥–∞—Ç–Ω–∏—Ö —Ü—ñ–ª–∏—Ö —á–∏—Å–µ–ª (1 ‚â§ N ‚â§ 100 000). –ù–µ–æ–±—Ö—ñ–¥–Ω–æ –æ–±—Ä–æ–±–∏—Ç–∏ Q –∑–∞–ø–∏—Ç—ñ–≤ (1 ‚â§ Q ‚â§ 50 000) –¥–≤–æ—Ö —Ç–∏–ø—ñ–≤

Range(L, R) ‚Äî –æ–±—á–∏—Å–ª–∏—Ç–∏ —Å—É–º—É –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ array[L : R + 1].
Update(index, value) ‚Äî –ø—Ä–∏—Å–≤–æ—ó—Ç–∏ array[index] ‚Üê value.

2. –†–µ–∞–ª—ñ–∑—É–π—Ç–µ —á–æ—Ç–∏—Ä–∏ —Ñ—É–Ω–∫—Ü—ñ—ó

range_sum_no_cache(array, left, right) ‚Äî –ø–æ–≤–µ—Ä—Ç–∞—î —Å—É–º—É –±–µ–∑ –∫–µ—à—É–≤–∞–Ω–Ω—è.
update_no_cache(array, index, value) ‚Äî –æ–Ω–æ–≤–ª—é—î –µ–ª–µ–º–µ–Ω—Ç –±–µ–∑ –∫–µ—à—É–≤–∞–Ω–Ω—è.
range_sum_with_cache(array, left, right) ‚Äî –≤–∏–∫–æ–Ω—É—î –ø–æ—à—É–∫ —É –≥–æ—Ç–æ–≤–æ–º—É –∫–ª–∞—Å—ñ LRUCache (—î–º–Ω—ñ—Å—Ç—å K = 1000). –Ø–∫—â–æ cache.get() –ø–æ–≤–µ—Ä—Ç–∞—î ‚àí1 (cache-miss), –æ–±—á–∏—Å–ª—é—î —Å—É–º—É, –∑–±–µ—Ä—ñ–≥–∞—î —ó—ó –º–µ—Ç–æ–¥–æ–º put() —ñ –ø–æ–≤–µ—Ä—Ç–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
update_with_cache(array, index, value) ‚Äî –æ–Ω–æ–≤–ª—é—î –º–∞—Å–∏–≤ —ñ –≤–∏–¥–∞–ª—è—î –≤—Å—ñ –¥—ñ–∞–ø–∞–∑–æ–Ω–∏ –∑ –∫–µ—à—É, —â–æ –º—ñ—Å—Ç—è—Ç—å –∑–º—ñ–Ω–µ–Ω–∏–π index. –Ü–Ω–≤–∞–ª—ñ–¥–∞—Ü—ñ—è –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è –ª—ñ–Ω—ñ–π–Ω–∏–º –ø—Ä–æ—Ö–æ–¥–æ–º –ø–æ –∫–ª—é—á–∞—Ö –∫–µ—à—É ‚Äî —ñ–Ω—à–æ—ó –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∫–ª–∞—Å—É –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ.

3.  –î–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ —Ç–∞–∫—É —Ñ—É–Ω–∫—Ü—ñ—é –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –º–∞—Å–∏–≤—É –∑–∞–ø–∏—Ç—ñ–≤:

```python
import random

def make_queries(n, q, hot_pool=30, p_hot=0.95, p_update=0.03):
    hot = [(random.randint(0, n//2), random.randint(n//2, n-1))
          for _ in range(hot_pool)]
    queries = []
    for _ in range(q):
        if random.random() < p_update:        # ~3% –∑–∞–ø–∏—Ç—ñ–≤ ‚Äî Update
            idx = random.randint(0, n-1)
            val = random.randint(1, 100)
            queries.append(("Update", idx, val))
        else:                                 # ~97% ‚Äî Range
            if random.random() < p_hot:       # 95% ‚Äî ¬´–≥–∞—Ä—è—á—ñ¬ª –¥—ñ–∞–ø–∞–∑–æ–Ω–∏
                left, right = random.choice(hot)
            else:                             # 5% ‚Äî –≤–∏–ø–∞–¥–∫–æ–≤—ñ –¥—ñ–∞–ø–∞–∑–æ–Ω–∏
                left = random.randint(0, n-1)
                right = random.randint(left, n-1)
            queries.append(("Range", left, right))
    return queries
```

–¶—è —Ñ—É–Ω–∫—Ü—ñ—è —Å—Ç–≤–æ—Ä—é—î —Å–ø–∏—Å–æ–∫ —ñ–∑ 50 000 –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ –º–∞—Å–∏–≤—É –∑ 100 000 –µ–ª–µ–º–µ–Ω—Ç—ñ–≤. –¢—Ä–∏ –≤—ñ–¥—Å–æ—Ç–∫–∏ ‚Äî —Ü–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –æ–∫—Ä–µ–º–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤, —Ä–µ—à—Ç–∞ ‚Äî –∑–∞–ø–∏—Ç–∏ –Ω–∞ –ø—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ —Å—É–º–∏. –î–ª—è –±—ñ–ª—å—à–æ—Å—Ç—ñ —Ç–∞–∫–∏—Ö Range-–∑–∞–ø–∏—Ç—ñ–≤ (95‚ÄØ%) –æ–±–∏—Ä–∞—î—Ç—å—Å—è –æ–¥–∏–Ω —ñ–∑ —Ç—Ä–∏–¥—Ü—è—Ç–∏ –∑–∞–∑–¥–∞–ª–µ–≥—ñ–¥—å –≤–∏–ø–∞–¥–∫–æ–≤–æ –≤–∏–∑–Ω–∞—á–µ–Ω–∏—Ö ¬´–≥–∞—Ä—è—á–∏—Ö¬ª –¥—ñ–∞–ø–∞–∑–æ–Ω—ñ–≤, —Ç–æ–±—Ç–æ –≤–æ–Ω–∏ –±–∞–≥–∞—Ç–æ—Ä–∞–∑–æ–≤–æ –ø–æ–≤—Ç–æ—Ä—é—é—Ç—å—Å—è –ø—Ä–æ—Ç—è–≥–æ–º —Ç–µ—Å—Ç—É. –†–µ—à—Ç–∞ –∑–∞–ø–∏—Ç—ñ–≤ (5‚ÄØ%) —Ñ–æ—Ä–º—É—é—Ç—å—Å—è –ø–æ–≤–Ω—ñ—Å—Ç—é –≤–∏–ø–∞–¥–∫–æ–≤–∏–º —á–∏–Ω–æ–º.

–¢–∞–∫–∞ –º–æ–¥–µ–ª—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –Ω–∞–±–ª–∏–∂–µ–Ω–∞ –¥–æ —Ä–µ–∞–ª—å–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤ —ñ–∑ –ø–æ–ø—É–ª—è—Ä–Ω–∏–º–∏ –π —Ä—ñ–¥–∫—ñ—Å–Ω–∏–º–∏ –¥—ñ–∞–ø–∞–∑–æ–Ω–∞–º–∏, —â–æ –¥–æ–∑–≤–æ–ª—è—î –æ—Ü—ñ–Ω–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—å –∫–µ—à—É —Å–∞–º–µ –≤ —É–º–æ–≤–∞—Ö –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É.

    –ü–æ—è—Å–Ω–µ–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤:

    n ‚Äî —Ä–æ–∑–º—ñ—Ä –º–∞—Å–∏–≤—É, –¥–ª—è —Ü—å–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ n = 100_000.

    q ‚Äî –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Ç—ñ–≤ —É —Ç–µ—Å—Ç—ñ, –¥–ª—è —Ü—å–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ q = 50_000.

    hot_pool ‚Äî –∫—ñ–ª—å–∫—ñ—Å—Ç—å ¬´–≥–∞—Ä—è—á–∏—Ö¬ª (—á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω–∏—Ö) –¥—ñ–∞–ø–∞–∑–æ–Ω—ñ–≤, —Ç–æ–±—Ç–æ —Ç–∏—Ö –≤—ñ–¥—Ä—ñ–∑–∫—ñ–≤, –¥–æ —è–∫–∏—Ö –∑–∞–ø–∏—Ç–∏ –±—É–¥—É—Ç—å –Ω–∞–¥—Ö–æ–¥–∏—Ç–∏ –Ω–∞–π—á–∞—Å—Ç—ñ—à–µ. –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 30.

    p_hot ‚Äî –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å, —â–æ –Ω–æ–≤–∏–π –∑–∞–ø–∏—Ç —Ç–∏–ø—É Range –±—É–¥–µ –≤–∑—è—Ç–æ —Å–∞–º–µ –∑ —Ü—å–æ–≥–æ ¬´–≥–∞—Ä—è—á–æ–≥–æ¬ª –ø—É–ª—É. –£ –Ω–∞—à—ñ–π –º–æ–¥–µ–ª—ñ —Ü–µ 95‚ÄØ%, —Ç–æ–±—Ç–æ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ –≤—Å—ñ Range-–∑–∞–ø–∏—Ç–∏ –¥—É–±–ª—é—é—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ñ –¥—ñ–∞–ø–∞–∑–æ–Ω–∏.

    p_update ‚Äî —á–∞—Å—Ç–∫–∞ –∑–∞–ø–∏—Ç—ñ–≤, —è–∫—ñ —î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º –∑–Ω–∞—á–µ–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç–∞. –£ –Ω–∞—à–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ 3‚ÄØ% (—Ä–µ—à—Ç–∞ 97‚ÄØ% ‚Äî —Ü–µ –∑–∞–ø–∏—Ç–∏ –Ω–∞ —Å—É–º—É).

4.  –í–∏–º—ñ—Ä—è–π—Ç–µ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –≤—Å—ñ—î—ó –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ –∑–∞–ø–∏—Ç—ñ–≤ –¥–≤—ñ—á—ñ ‚Äî –±–µ–∑ –∫–µ—à—É —Ç–∞ –∑ –∫–µ—à–µ–º ‚Äî —ñ –≤–∏–≤–µ–¥—ñ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —É –∑—Ä–æ–∑—É–º—ñ–ª–æ–º—É —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –≤–∏–≥–ª—è–¥—ñ, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥

        –ö—Ä–∏—Ç–µ—Ä—ñ—ó –ø—Ä–∏–π–Ω—è—Ç—Ç—è

        –£—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó: range_sum_no_cache, update_no_cache, range_sum_with_cache, update_with_cache ‚Äî —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ —Ç–∞ –ø—Ä–∞—Ü—é—é—Ç—å.
        –ü—Ä–æ–≥—Ä–∞–º–∞ –≤–∏–º—ñ—Ä—é—î —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤ –∑ –∫–µ—à–µ–º —ñ –±–µ–∑ –Ω—å–æ–≥–æ —Ç–∞ –≤–∏–≤–æ–¥–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —É –∑—Ä–æ–∑—É–º—ñ–ª–æ–º—É –≤–∏–≥–ª—è–¥—ñ.
        –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ñ —É –∑—Ä—É—á–Ω–æ–º—É –¥–ª—è —Ä–æ–∑—É–º—ñ–Ω–Ω—è —Ñ–æ—Ä–º–∞—Ç—ñ, —â–æ–± –º–æ–∂–Ω–∞ –±—É–ª–æ –æ—Ü—ñ–Ω–∏—Ç–∏ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è LRU-–∫–µ—à—É.
        –ö–æ–¥ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –±–µ–∑ –ø–æ–º–∏–ª–æ–∫ —ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Ç–µ—Ö–Ω—ñ—á–Ω–∏–º –≤–∏–º–æ–≥–∞–º.


        –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–≤–µ–¥–µ–Ω–Ω—è –≤ —Ç–µ—Ä–º—ñ–Ω–∞–ª –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º–∏

        –ë–µ–∑ –∫–µ—à—É :  12.06 c
        LRU-–∫–µ—à  :   4.71 c  (–ø—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è √ó2.6)

##### –ó–∞–≤–¥–∞–Ω–Ω—è 2. –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è Rate Limiter –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –∞–ª–≥–æ—Ä–∏—Ç–º—É Sliding Window –¥–ª—è –æ–±–º–µ–∂–µ–Ω–Ω—è —á–∞—Å—Ç–æ—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —É —á–∞—Ç—ñ

–£ —á–∞—Ç-—Å–∏—Å—Ç–µ–º—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –º–µ—Ö–∞–Ω—ñ–∑–º –æ–±–º–µ–∂–µ–Ω–Ω—è —á–∞—Å—Ç–æ—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è —Å–ø–∞–º—É. –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ–≤–∏–Ω–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∞–ª–≥–æ—Ä–∏—Ç–º Sliding Window –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—é —á–∞—Å–æ–≤–∏—Ö —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤, —è–∫–∏–π –¥–æ–∑–≤–æ–ª—è—î –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —É –∑–∞–¥–∞–Ω–æ–º—É —á–∞—Å–æ–≤–æ–º—É –≤—ñ–∫–Ω—ñ –π –æ–±–º–µ–∂—É–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å, —è–∫—â–æ –ª—ñ–º—ñ—Ç –ø–µ—Ä–µ–≤–∏—â–µ–Ω–æ.

###### –¢–µ—Ö–Ω—ñ—á–Ω—ñ —É–º–æ–≤–∏

1. –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ–≤–∏–Ω–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∞–ª–≥–æ—Ä–∏—Ç–º Sliding Window –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—é —á–∞—Å–æ–≤–∏—Ö —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤.

2. –ë–∞–∑–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —Å–∏—Å—Ç–µ–º–∏: —Ä–æ–∑–º—ñ—Ä –≤—ñ–∫–Ω–∞ (window_size) ‚Äî 10 —Å–µ–∫—É–Ω–¥ —ñ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —É –≤—ñ–∫–Ω—ñ (max_requests) ‚Äî 1.

3. –†–µ–∞–ª—ñ–∑—É–π—Ç–µ –∫–ª–∞—Å SlidingWindowRateLimiter.

4. –†–µ–∞–ª—ñ–∑—É–π—Ç–µ –º–µ—Ç–æ–¥–∏ –∫–ª–∞—Å—É:

\_cleanup_window ‚Äî –¥–ª—è –æ—á–∏—â–µ–Ω–Ω—è –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ –∑ –≤—ñ–∫–Ω–∞ —Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —á–∞—Å–æ–≤–æ–≥–æ –≤—ñ–∫–Ω–∞;
can_send_message ‚Äî –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ –ø–æ—Ç–æ—á–Ω–æ–º—É —á–∞—Å–æ–≤–æ–º—É –≤—ñ–∫–Ω—ñ;
record_message ‚Äî –¥–ª—è –∑–∞–ø–∏—Å—É –Ω–æ–≤–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –π –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞;
time_until_next_allowed ‚Äî –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —á–∞—Å—É –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –¥–æ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è. 5. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å ‚Äî collections.deque.

###### –ö—Ä–∏—Ç–µ—Ä—ñ—ó –ø—Ä–∏–π–Ω—è—Ç—Ç—è

üìå–ö—Ä–∏—Ç–µ—Ä—ñ—ó –ø—Ä–∏–π–Ω—è—Ç—Ç—è –¥–æ–º–∞—à–Ω—å–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è —î –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ—é —É–º–æ–≤–æ—é —Ä–æ–∑–≥–ª—è–¥—É –¥–æ–º–∞—à–Ω—å–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è –º–µ–Ω—Ç–æ—Ä–æ–º. –Ø–∫—â–æ —è–∫–∏–π—Å—å —ñ–∑ –∫—Ä–∏—Ç–µ—Ä—ñ—ó–≤ –Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–æ, –º–µ–Ω—Ç–æ—Ä –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î –î–ó –Ω–∞ –¥–æ–æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è –±–µ–∑ –æ—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è. –Ø–∫—â–æ –≤–∞–º ¬´—Ç—ñ–ª—å–∫–∏ —É—Ç–æ—á–Ω–∏—Ç–∏¬ªüòâ –∞–±–æ –≤–∏ –∑–∞—Å—Ç–æ–ø–æ—Ä–∏–ª–∏—Å—è –Ω–∞ —è–∫–æ–º—É—Å—å –∑ –µ—Ç–∞–ø—ñ–≤ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è ‚Äî –∑–≤–µ—Ä—Ç–∞–π—Ç–µ—Å—è –¥–æ –º–µ–Ω—Ç–æ—Ä–∞ —É Slack).

1. –ü—Ä–∏ —Å–ø—Ä–æ–±—ñ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Ä–∞–Ω—ñ—à–µ –Ω—ñ–∂ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥ –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –º–µ—Ç–æ–¥–æ–º can_send_message –∑–Ω–∞—á–µ–Ω–Ω—è False.

2. –ü—Ä–∏ –ø–µ—Ä—à–æ–º—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—ñ –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞–≤–∂–¥–∏ –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è True.

3. –ü—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –≤—Å—ñ—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –∑ –≤—ñ–∫–Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è –∑–∞–ø–∏—Å –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö.

4. –ú–µ—Ç–æ–¥ time_until_next_allowed –ø–æ–≤–µ—Ä—Ç–∞—î —á–∞—Å –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö.

5. –¢–µ—Å—Ç–æ–≤–∞ —Ñ—É–Ω–∫—Ü—ñ—è –∑–≥—ñ–¥–Ω–æ –∑ –ø—Ä–∏–∫–ª–∞–¥–æ–º –ø—Ä–æ–≥–Ω–∞–Ω–∞ –π –ø—Ä–∞—Ü—é—î –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –æ—á—ñ–∫—É–≤–∞–Ω—å.

###### –®–∞–±–ª–æ–Ω –∑–∞–≤–¥–∞–Ω–Ω—è

```python
import random
from typing import Dict
import time
from collections import deque

class SlidingWindowRateLimiter:
    def __init__(self, window_size: int = 10, max_requests: int = 1):
				pass
    def _cleanup_window(self, user_id: str, current_time: float) -> None:
        pass

    def can_send_message(self, user_id: str) -> bool:
        pass

    def record_message(self, user_id: str) -> bool:
        pass

    def time_until_next_allowed(self, user_id: str) -> float:
        pass

# –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è —Ä–æ–±–æ—Ç–∏
def test_rate_limiter():
    # –°—Ç–≤–æ—Ä—é—î–º–æ rate limiter: –≤—ñ–∫–Ω–æ 10 —Å–µ–∫—É–Ω–¥, 1 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    limiter = SlidingWindowRateLimiter(window_size=10, max_requests=1)

    # –°–∏–º—É–ª—é—î–º–æ –ø–æ—Ç—ñ–∫ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (–ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ ID –≤—ñ–¥ 1 –¥–æ 20)
    print("\\n=== –°–∏–º—É–ª—è—Ü—ñ—è –ø–æ—Ç–æ–∫—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å ===")
    for message_id in range(1, 11):
        # –°–∏–º—É–ª—é—î–º–æ —Ä—ñ–∑–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (ID –≤—ñ–¥ 1 –¥–æ 5)
        user_id = message_id % 5 + 1

        result = limiter.record_message(str(user_id))
        wait_time = limiter.time_until_next_allowed(str(user_id))

        print(f"–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è {message_id:2d} | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {user_id} | "
              f"{'‚úì' if result else f'√ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è {wait_time:.1f}—Å)'}")

        # –ù–µ–≤–µ–ª–∏–∫–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ –º—ñ–∂ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏ –¥–ª—è —Ä–µ–∞–ª—ñ—Å—Ç–∏—á–Ω–æ—Å—Ç—ñ
        # –í–∏–ø–∞–¥–∫–æ–≤–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ –≤—ñ–¥ 0.1 –¥–æ 1 —Å–µ–∫—É–Ω–¥–∏
        time.sleep(random.uniform(0.1, 1.0))

    # –ß–µ–∫–∞—î–º–æ, –ø–æ–∫–∏ –≤—ñ–∫–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å—Å—è
    print("\\n–û—á—ñ–∫—É—î–º–æ 4 —Å–µ–∫—É–Ω–¥–∏...")
    time.sleep(4)

    print("\\n=== –ù–æ–≤–∞ —Å–µ—Ä—ñ—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø—ñ—Å–ª—è –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è ===")
    for message_id in range(11, 21):
        user_id = message_id % 5 + 1
        result = limiter.record_message(str(user_id))
        wait_time = limiter.time_until_next_allowed(str(user_id))
        print(f"–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è {message_id:2d} | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {user_id} | "
              f"{'‚úì' if result else f'√ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è {wait_time:.1f}—Å)'}")
        # –í–∏–ø–∞–¥–∫–æ–≤–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ –≤—ñ–¥ 0.1 –¥–æ 1 —Å–µ–∫—É–Ω–¥–∏
        time.sleep(random.uniform(0.1, 1.0))

if __name__ == "__main__":
    test_rate_limiter()
```

###### –û—á—ñ–∫—É–≤–∞–Ω–µ –≤–∏–≤–µ–¥–µ–Ω–Ω—è

    === –°–∏–º—É–ª—è—Ü—ñ—è –ø–æ—Ç–æ–∫—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å ===
    –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  1 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 2 | ‚úì
    –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  2 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 3 | ‚úì
    –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  3 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 4 | ‚úì
    –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  4 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 5 | ‚úì
    –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  5 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 1 | ‚úì
    –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  6 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 2 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 7.0—Å)
    –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  7 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 3 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 6.5—Å)
    –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  8 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 4 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 7.0—Å)
    –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è  9 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 5 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 6.8—Å)
    –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 10 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 1 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 7.4—Å)

    –û—á—ñ–∫—É—î–º–æ 4 —Å–µ–∫—É–Ω–¥–∏...

    === –ù–æ–≤–∞ —Å–µ—Ä—ñ—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø—ñ—Å–ª—è –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è ===
    –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 11 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 2 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 1.0—Å)
    –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 12 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 3 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 0.7—Å)
    –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 13 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 4 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 0.4—Å)
    –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 14 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 5 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 0.0—Å)
    –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 15 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 1 | ‚úì
    –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 16 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 2 | ‚úì
    –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 17 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 3 | ‚úì
    –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 18 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 4 | ‚úì
    –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 19 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 5 | ‚úì
    –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è 20 | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á 1 | √ó (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è 7.0—Å)

```

```
